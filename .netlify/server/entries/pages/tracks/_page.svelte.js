import{w as e,q as s,o as t,j as r,u as c,c as i,p as a,h as n,e as d,d as o,k as l,g as u,F as p,i as h,m as x,a as m}from"../../../chunks/svelte-vendor.js";import{I as v,L as g,B as k,a as f,t as T}from"../../../chunks/voice-control.js";import{A as b}from"../../../chunks/audio-engine.js";let w;const z=new class{audioEngine;tracks;trackOrder;selectedTrackId;selectedClipIds;constructor(s){this.audioEngine=s,this.tracks=e(new Map),this.trackOrder=e([]),this.selectedTrackId=e(null),this.selectedClipIds=e(new Set)}createTrack(e,t){const r=this.generateId(),c=this.getDefaultColors(),i=s(this.trackOrder).length%c.length,a={id:r,name:t||`${this.capitalizeFirst(e)} ${s(this.trackOrder).length+1}`,type:e,color:c[i],order:s(this.trackOrder).length,height:"medium",clips:[],settings:{volume:0,pan:0,mute:!1,solo:!1,recordArm:!1,monitor:!1,frozen:!1,input:"default",output:"master"}};return"folder"!==e&&this.audioEngine.addTrack({id:r,name:a.name,type:"midi"===e?"midi":"audio",color:a.color}),this.tracks.update(e=>(e.set(r,a),new Map(e))),this.trackOrder.update(e=>[...e,r]),this.emitEvent("track:created",{trackId:r,track:a}),a}deleteTrack(e){const t=s(this.tracks).get(e);t&&("folder"!==t.type&&this.audioEngine.removeTrack(e),"folder"===t.type&&this.ungroupTracks(e),this.tracks.update(s=>(s.delete(e),new Map(s))),this.trackOrder.update(s=>s.filter(s=>s!==e)),this.selectedTrackId.update(s=>s===e?null:s),this.emitEvent("track:deleted",{trackId:e}))}duplicateTrack(e){const t=s(this.tracks).get(e);if(!t)return null;const r=this.createTrack(t.type,`${t.name} (Copy)`);return this.updateTrackSettings(r.id,{...t.settings}),this.tracks.update(e=>{const s=e.get(r.id);return s&&(s.color=t.color),new Map(e)}),r}renameTrack(e,s){this.tracks.update(t=>{const r=t.get(e);if(r){r.name=s;const t=this.audioEngine.getTrack(e);t&&(t.name=s)}return new Map(t)}),this.emitEvent("track:updated",{trackId:e,property:"name",value:s})}reorderTrack(e,s){this.trackOrder.update(t=>{const r=t.indexOf(e);if(-1===r)return t;const c=[...t];return c.splice(r,1),c.splice(s,0,e),this.tracks.update(e=>(c.forEach((s,t)=>{const r=e.get(s);r&&(r.order=t)}),new Map(e))),c}),this.emitEvent("track:reordered",{trackId:e,newIndex:s})}groupTracks(e,t){const r=this.createTrack("folder",t).id,c=s(this.trackOrder).indexOf(r);return e.forEach((e,s)=>{this.tracks.update(s=>{const t=s.get(e);return t&&(t.parentId=r),new Map(s)}),this.reorderTrack(e,c+s+1)}),r}ungroupTracks(e){this.tracks.update(s=>(s.forEach(s=>{s.parentId===e&&(s.parentId=void 0)}),new Map(s)))}updateTrackSettings(e,s){this.tracks.update(t=>{const r=t.get(e);if(!r)return t;r.settings={...r.settings,...s};const c=this.audioEngine.getTrack(e);return c&&(void 0!==s.volume&&c.setVolume(s.volume),void 0!==s.pan&&c.setPan(s.pan),void 0!==s.mute&&c.setMute(s.mute),void 0!==s.solo&&c.setSolo(s.solo)),new Map(t)}),this.emitEvent("track:updated",{trackId:e,settings:s})}setTrackColor(e,s){this.tracks.update(t=>{const r=t.get(e);return r&&(r.color=s),new Map(t)}),this.emitEvent("track:updated",{trackId:e,property:"color",value:s})}setTrackHeight(e,s){this.tracks.update(t=>{const r=t.get(e);return r&&(r.height=s),new Map(t)})}async freezeTrack(e){const t=s(this.tracks).get(e);t&&!t.settings.frozen&&this.updateTrackSettings(e,{frozen:!0})}unfreezeTrack(e){this.updateTrackSettings(e,{frozen:!1})}selectTrack(e){this.selectedTrackId.set(e),this.emitEvent("track:selected",{trackId:e})}getSelectedTrack(){const e=s(this.selectedTrackId);return e&&s(this.tracks).get(e)||null}getTrack(e){return s(this.tracks).get(e)}getAllTracks(){return Array.from(s(this.tracks).values())}getOrderedTracks(){const e=s(this.tracks);return s(this.trackOrder).map(s=>e.get(s)).filter(Boolean)}addClip(e,s){this.tracks.update(t=>{const r=t.get(e);return r&&r.clips.push(s),new Map(t)})}removeClip(e,s){this.tracks.update(t=>{const r=t.get(e);return r&&(r.clips=r.clips.filter(e=>e.id!==s)),new Map(t)})}selectClip(e,s=!1){this.selectedClipIds.update(t=>(s||t.clear(),t.add(e),new Set(t)))}clearClipSelection(){this.selectedClipIds.set(new Set)}generateId(){return`track-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}capitalizeFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}getDefaultColors(){return["#ff006e","#00d9ff","#00ff88","#a855f7","#ffaa00","#ff3366","#c084fc","#ffd700"]}emitEvent(e,s){"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent(e,{detail:s}))}}((w||(w=b.getInstance({sampleRate:48e3,latencyHint:"interactive",lookAhead:.1})),w)),y=z.tracks,$=z.trackOrder,I=z.selectedTrackId;z.selectedClipIds;const C=t([y,$],([e,s])=>s.map(s=>e.get(s)).filter(Boolean)),S=t([y,I],([e,s])=>s&&e.get(s)||null);t(I,e=>null!==e);const E=t(y,e=>e.size);function M(e,s){e.component(e=>{var t;let{track:p}=s;p.name;let h=!1;const x=r(t??={},"$selectedTrackId",I)===p.id,m={audio:"audio",midi:"midi",aux:"volume",folder:"folder"};let f,T=!0;function b(e){e.push(`<div${i(`track-row glass rounded-control p-3 mb-2 cursor-pointer transition-all ${d(x?"ring-2 ring-accent-primary selected":"")}`,"svelte-10yu844")} role="button" tabindex="0">`),a(e,"div",75,0),e.push('<div class="track-content flex items-center gap-3">'),a(e,"div",82,2),e.push(`<div class="track-color w-1 h-12 rounded-full flex-shrink-0"${n(`background-color: ${d(p.color)};`)}>`),a(e,"div",84,4),e.push("</div>"),o(),e.push(" "),v(e,{name:m[p.type],size:"md"}),e.push('\x3c!----\x3e <div class="track-name flex-1 min-w-0">'),a(e,"div",93,4),e.push("\x3c!--[!--\x3e"),g(e,{size:"sm",weight:"semibold",class:"block truncate",children:l(e=>{e.push(`\x3c!----\x3e${u(p.name)}`)})}),e.push("\x3c!----\x3e "),g(e,{size:"xs",color:"var(--color-text-secondary)",class:"block truncate",children:l(e=>{e.push(`\x3c!----\x3e${u("folder"===p.type?`${p.clips?.length||0} tracks`:`${p.clips?.length||0} clips`)}`)})}),e.push("\x3c!----\x3e"),e.push("\x3c!--]--\x3e</div>"),o(),e.push(' <div class="track-controls flex gap-1">'),a(e,"div",117,4),"folder"!==p.type?(e.push("\x3c!--[--\x3e"),k(e,{variant:p.settings.recordArm?"danger":"ghost",size:"xs",onclick:e=>{e.stopPropagation(),z.updateTrackSettings(p.id,{recordArm:!p.settings.recordArm})},children:l(e=>{v(e,{name:"record",size:"xs"})})})):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e "),k(e,{variant:p.settings.mute?"danger":"ghost",size:"xs",onclick:e=>{e.stopPropagation(),z.updateTrackSettings(p.id,{mute:!p.settings.mute})},children:l(e=>{e.push("\x3c!----\x3eM")})}),e.push("\x3c!----\x3e "),k(e,{variant:p.settings.solo?"primary":"ghost",size:"xs",onclick:e=>{e.stopPropagation(),z.updateTrackSettings(p.id,{solo:!p.settings.solo})},children:l(e=>{e.push("\x3c!----\x3eS")})}),e.push('\x3c!----\x3e <div class="relative">'),a(e,"div",157,6),k(e,{variant:"ghost",size:"xs",onclick:e=>{e.stopPropagation(),h=!h},children:l(e=>{v(e,{name:"settings",size:"xs"})})}),e.push("\x3c!----\x3e "),h?(e.push("\x3c!--[--\x3e"),e.push('<div class="track-menu glass-purple rounded-control p-2 absolute right-0 mt-1 z-10 min-w-32 svelte-10yu844">'),a(e,"div",170,10),e.push('<button class="menu-item svelte-10yu844">'),a(e,"button",171,12),e.push("<span>"),a(e,"span",172,14),e.push("Duplicate</span>"),o(),e.push("</button>"),o(),e.push(' <button class="menu-item text-danger svelte-10yu844">'),a(e,"button",174,12),e.push("<span>"),a(e,"span",175,14),e.push("Delete</span>"),o(),e.push("</button>"),o(),e.push("</div>"),o()):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),e.push("</div>"),o(),e.push("</div>"),o()}do{T=!0,f=e.copy(),b(f)}while(!T);e.subsume(f),t&&c(t)},M)}function A(e,s){e.component(e=>{var s;let t=!1;if(e.push('<div class="track-list glass-strong rounded-panel svelte-1w40grs">'),a(e,"div",42,0),e.push('<div class="track-list-header glass rounded-control p-4 mb-2 flex items-center justify-between">'),a(e,"div",44,2),g(e,{size:"lg",weight:"bold",children:l(e=>{e.push(`\x3c!----\x3eTracks (${u(r(s??={},"$orderedTracks",C).length)})`)})}),e.push('\x3c!----\x3e <div class="relative">'),a(e,"div",47,4),k(e,{variant:"primary",size:"sm",onclick:()=>t=!t,children:l(e=>{v(e,{name:"plus",size:"sm"}),e.push('\x3c!----\x3e <span class="ml-2">'),a(e,"span",54,8),e.push("Add Track</span>"),o()})}),e.push("\x3c!----\x3e "),t?(e.push("\x3c!--[--\x3e"),e.push('<div class="add-menu glass-purple rounded-control p-2 absolute right-0 mt-2 z-10 min-w-48 svelte-1w40grs">'),a(e,"div",58,8),e.push('<button class="menu-item svelte-1w40grs">'),a(e,"button",59,10),v(e,{name:"audio",size:"sm"}),e.push("\x3c!----\x3e <span>"),a(e,"span",64,12),e.push("Audio Track</span>"),o(),e.push("</button>"),o(),e.push(' <button class="menu-item svelte-1w40grs">'),a(e,"button",66,10),v(e,{name:"midi",size:"sm"}),e.push("\x3c!----\x3e <span>"),a(e,"span",71,12),e.push("MIDI Track</span>"),o(),e.push("</button>"),o(),e.push(' <button class="menu-item svelte-1w40grs">'),a(e,"button",73,10),v(e,{name:"volume",size:"sm"}),e.push("\x3c!----\x3e <span>"),a(e,"span",78,12),e.push("Aux Track</span>"),o(),e.push("</button>"),o(),e.push(' <button class="menu-item svelte-1w40grs">'),a(e,"button",80,10),v(e,{name:"folder",size:"sm"}),e.push("\x3c!----\x3e <span>"),a(e,"span",85,12),e.push("Folder</span>"),o(),e.push("</button>"),o(),e.push("</div>"),o()):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),e.push(' <div class="tracks-container svelte-1w40grs">'),a(e,"div",93,2),0===r(s??={},"$orderedTracks",C).length)e.push("\x3c!--[--\x3e"),e.push('<div class="empty-state glass rounded-control p-12 text-center svelte-1w40grs">'),a(e,"div",95,6),v(e,{name:"waveform",size:"xl",class:"mb-4 opacity-30"}),e.push("\x3c!----\x3e "),g(e,{size:"lg",color:"var(--color-text-secondary)",class:"block mb-2",children:l(e=>{e.push("\x3c!----\x3eNo tracks yet")})}),e.push("\x3c!----\x3e "),g(e,{size:"sm",color:"var(--color-text-tertiary)",children:l(e=>{e.push('\x3c!----\x3eClick "Add Track" to get started')})}),e.push("\x3c!----\x3e</div>"),o();else{e.push("\x3c!--[!--\x3e"),e.push("\x3c!--[--\x3e");const t=h(r(s??={},"$orderedTracks",C));for(let s=0,r=t.length;r>s;s++){let r=t[s];e.push('<div draggable="true">'),a(e,"div",106,8),M(e,{track:r}),e.push("\x3c!----\x3e</div>"),o()}e.push("\x3c!--]--\x3e")}e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),s&&c(s)},A)}function j(e,s){e.component(e=>{var s;let t=!0;if(x(e,e=>{e.title(e=>{e.push("<title>Track Manager - DAWG AI</title>")})}),e.push('<div class="min-h-screen p-8">'),a(e,"div",61,0),e.push('<div class="glass-purple rounded-panel p-6 mb-8 flex items-center justify-between">'),a(e,"div",63,2),e.push("<div>"),a(e,"div",64,4),e.push('<h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-accent-primary to-accent-secondary bg-clip-text text-transparent">'),a(e,"h1",65,6),e.push("Module 3: Track Manager</h1>"),o(),e.push(' <p class="text-white/70">'),a(e,"p",68,6),e.push("Track creation, organization, and management</p>"),o(),e.push("</div>"),o(),e.push(' <div class="flex gap-3">'),a(e,"div",71,4),k(e,{variant:"secondary",size:"md",onclick:function(){confirm("Delete all tracks?")&&r(s??={},"$orderedTracks",C).forEach(e=>{z.deleteTrack(e.id)})},children:l(e=>{v(e,{name:"trash",size:"sm"}),e.push('\x3c!----\x3e <span class="ml-2">'),a(e,"span",74,8),e.push("Clear All</span>"),o()})}),e.push("\x3c!----\x3e "),k(e,{variant:"secondary",size:"md",onclick:function(){T.toggle(),t=!t},children:l(e=>{v(e,{name:t?"sun":"moon",size:"sm"}),e.push('\x3c!----\x3e <span class="ml-2">'),a(e,"span",79,8),e.push(`${u(t?"Light":"Dark")}</span>`),o()})}),e.push("\x3c!----\x3e</div>"),o(),e.push("</div>"),o(),e.push(' <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">'),a(e,"div",84,2),e.push('<div class="lg:col-span-2">'),a(e,"div",86,4),A(e),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="glass-strong rounded-panel p-6">'),a(e,"div",91,4),g(e,{size:"lg",weight:"bold",class:"mb-4 block",children:l(e=>{e.push("\x3c!----\x3eTrack Inspector")})}),e.push("\x3c!----\x3e "),r(s??={},"$selectedTrack",S)){e.push("\x3c!--[--\x3e"),e.push('<div class="space-y-6">'),a(e,"div",95,8),e.push("<div>"),a(e,"div",97,10),g(e,{size:"sm",weight:"semibold",class:"mb-2 block",children:l(e=>{e.push("\x3c!----\x3eTrack Info")})}),e.push('\x3c!----\x3e <div class="glass rounded-control p-3 space-y-2">'),a(e,"div",99,12),e.push('<div class="flex justify-between items-center">'),a(e,"div",100,14),g(e,{size:"xs",color:"var(--color-text-secondary)",children:l(e=>{e.push("\x3c!----\x3eName:")})}),e.push("\x3c!----\x3e "),g(e,{size:"sm",weight:"medium",children:l(e=>{e.push(`\x3c!----\x3e${u(r(s??={},"$selectedTrack",S).name)}`)})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex justify-between items-center">'),a(e,"div",104,14),g(e,{size:"xs",color:"var(--color-text-secondary)",children:l(e=>{e.push("\x3c!----\x3eType:")})}),e.push("\x3c!----\x3e "),g(e,{size:"sm",weight:"medium",class:"capitalize",children:l(e=>{e.push(`\x3c!----\x3e${u(r(s??={},"$selectedTrack",S).type)}`)})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex justify-between items-center">'),a(e,"div",108,14),g(e,{size:"xs",color:"var(--color-text-secondary)",children:l(e=>{e.push("\x3c!----\x3eClips:")})}),e.push("\x3c!----\x3e "),g(e,{size:"sm",weight:"medium",children:l(e=>{e.push(`\x3c!----\x3e${u(r(s??={},"$selectedTrack",S).clips?.length||0)}`)})}),e.push("\x3c!----\x3e</div>"),o(),e.push("</div>"),o(),e.push("</div>"),o(),e.push(" <div>"),a(e,"div",116,10),g(e,{size:"sm",weight:"semibold",class:"mb-2 block",children:l(e=>{e.push("\x3c!----\x3eTrack Color")})}),e.push('\x3c!----\x3e <div class="flex gap-2">'),a(e,"div",118,12),e.push("\x3c!--[--\x3e");const t=h(["#ff006e","#00d9ff","#00ff88","#a855f7","#ffaa00","#ff3366","#c084fc","#ffd700"]);for(let c=0,l=t.length;l>c;c++){let l=t[c];e.push(`<button${i(`w-8 h-8 rounded-control transition-transform hover:scale-110 ${d(r(s??={},"$selectedTrack",S).color===l?"ring-2 ring-white":"")}`)}${n(`background-color: ${d(l)};`)}${m("aria-label",`Set color to ${d(l)}`)}>`),a(e,"button",120,16),e.push("</button>"),o()}e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),e.push(" <div>"),a(e,"div",131,10),g(e,{size:"sm",weight:"semibold",class:"mb-3 block",children:l(e=>{e.push("\x3c!----\x3eTrack Settings")})}),e.push('\x3c!----\x3e <div class="space-y-4">'),a(e,"div",133,12),e.push('<div class="flex items-center justify-between">'),a(e,"div",134,14),g(e,{size:"sm",children:l(e=>{e.push("\x3c!----\x3eVolume")})}),e.push("\x3c!----\x3e "),g(e,{size:"xs",mono:!0,class:"text-accent-primary",children:l(e=>{e.push(`\x3c!----\x3e${u(r(s??={},"$selectedTrack",S).settings.volume.toFixed(1))} dB`)})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex items-center justify-between">'),a(e,"div",141,14),g(e,{size:"sm",children:l(e=>{e.push("\x3c!----\x3ePan")})}),e.push("\x3c!----\x3e "),g(e,{size:"xs",mono:!0,class:"text-accent-primary",children:l(e=>{e.push(`\x3c!----\x3e${u((100*r(s??={},"$selectedTrack",S).settings.pan).toFixed(0))}%`)})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex items-center justify-between">'),a(e,"div",148,14),g(e,{size:"sm",children:l(e=>{e.push("\x3c!----\x3eMute")})}),e.push("\x3c!----\x3e "),f(e,{checked:r(s??={},"$selectedTrack",S).settings.mute,size:"sm",onchange:e=>z.updateTrackSettings(r(s??={},"$selectedTrack",S).id,{mute:e})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex items-center justify-between">'),a(e,"div",157,14),g(e,{size:"sm",children:l(e=>{e.push("\x3c!----\x3eSolo")})}),e.push("\x3c!----\x3e "),f(e,{checked:r(s??={},"$selectedTrack",S).settings.solo,size:"sm",onchange:e=>z.updateTrackSettings(r(s??={},"$selectedTrack",S).id,{solo:e})}),e.push("\x3c!----\x3e</div>"),o(),e.push(' <div class="flex items-center justify-between">'),a(e,"div",166,14),g(e,{size:"sm",children:l(e=>{e.push("\x3c!----\x3eRecord Arm")})}),e.push("\x3c!----\x3e "),f(e,{checked:r(s??={},"$selectedTrack",S).settings.recordArm,size:"sm",onchange:e=>z.updateTrackSettings(r(s??={},"$selectedTrack",S).id,{recordArm:e})}),e.push("\x3c!----\x3e</div>"),o(),e.push("</div>"),o(),e.push("</div>"),o(),e.push(" <div>"),a(e,"div",178,10),g(e,{size:"sm",weight:"semibold",class:"mb-2 block",children:l(e=>{e.push("\x3c!----\x3eTrack Height")})}),e.push('\x3c!----\x3e <div class="flex gap-2">'),a(e,"div",180,12),e.push("\x3c!--[--\x3e");const c=h(["collapsed","small","medium","large"]);for(let t=0,i=c.length;i>t;t++){let i=c[t];k(e,{variant:r(s??={},"$selectedTrack",S).height===i?"primary":"secondary",size:"xs",onclick:()=>z.setTrackHeight(r(s??={},"$selectedTrack",S).id,i),children:l(e=>{e.push(`\x3c!----\x3e${u(i.charAt(0).toUpperCase())}`)})})}e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),e.push("</div>"),o()}else e.push("\x3c!--[!--\x3e"),e.push('<div class="glass rounded-control p-8 text-center">'),a(e,"div",194,8),v(e,{name:"waveform",size:"xl",class:"mb-3 opacity-30"}),e.push("\x3c!----\x3e "),g(e,{size:"sm",color:"var(--color-text-secondary)",children:l(e=>{e.push("\x3c!----\x3eNo track selected")})}),e.push("\x3c!----\x3e</div>"),o();e.push("\x3c!--]--\x3e</div>"),o(),e.push("</div>"),o(),e.push(' <div class="glass rounded-control p-4 mt-8 flex items-center justify-between">'),a(e,"div",205,2),g(e,{size:"sm",color:"var(--color-text-secondary)",children:l(e=>{e.push(`\x3c!----\x3eModule 3: Track Manager • ${u(r(s??={},"$trackCount",E))} tracks`)})}),e.push("\x3c!----\x3e "),g(e,{size:"xs",color:"var(--color-text-tertiary)",children:l(e=>{e.push("\x3c!----\x3eDrag tracks to reorder • Double-click to rename")})}),e.push("\x3c!----\x3e</div>"),o(),e.push("</div>"),o(),s&&c(s)},j)}M[p]="src/lib/tracks/components/TrackRow.svelte",M.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")},A[p]="src/lib/tracks/components/TrackList.svelte",A.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")},j[p]="src/routes/tracks/+page.svelte",j.render=function(){throw new Error("Component.render(...) is no longer valid in Svelte 5. See https://svelte.dev/docs/svelte/v5-migration-guide#Components-are-no-longer-classes for more information")};export{j as default};
