import{o as e,w as s}from"./svelte-vendor.js";import{l as r}from"./audio-engine.js";r.warn("⚠️ Running without Supabase credentials - auth features disabled");const t=null,n=new class{supabase;constructor(){this.supabase=null}ensureSupabase(){if(!this.supabase)throw new Error("Supabase not configured - auth features unavailable in test mode");return this.supabase}async signUp(e,s,r){const{data:t,error:n}=await this.ensureSupabase().auth.signUp({email:e,password:s,options:{data:{name:r||null}}});if(n)throw new Error(`Sign up failed: ${n.message}`);if(!t.user)throw new Error("Sign up failed: No user returned");return t.user}async signIn(e,s){const{data:r,error:t}=await this.ensureSupabase().auth.signInWithPassword({email:e,password:s});if(t)throw new Error(`Sign in failed: ${t.message}`);if(!r.session)throw new Error("Sign in failed: No session returned");return r.session}async signOut(){const{error:e}=await this.ensureSupabase().auth.signOut();if(e)throw new Error(`Sign out failed: ${e.message}`)}async getSession(){const{data:{session:e},error:s}=await this.ensureSupabase().auth.getSession();return s?(r.error("Failed to get session:",s),null):e}async refreshSession(){const{data:e,error:s}=await this.ensureSupabase().auth.refreshSession();if(s)throw new Error(`Failed to refresh session: ${s.message}`);if(!e.session)throw new Error("Failed to refresh session: No session returned");return e.session}async getCurrentUser(){const{data:{user:e},error:s}=await this.ensureSupabase().auth.getUser();return s?(r.error("Failed to get user:",s),null):e}async updateUser(e){const{data:s,error:r}=await this.ensureSupabase().auth.updateUser({data:e});if(r)throw new Error(`Failed to update user: ${r.message}`);if(!s.user)throw new Error("Failed to update user: No user returned");return s.user}async resetPassword(e){const{error:s}=await this.ensureSupabase().auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(s)throw new Error(`Failed to send reset email: ${s.message}`)}async updatePassword(e){const{error:s}=await this.ensureSupabase().auth.updateUser({password:e});if(s)throw new Error(`Failed to update password: ${s.message}`)}async signInWithOAuth(e){const{error:s}=await this.ensureSupabase().auth.signInWithOAuth({provider:e,options:{redirectTo:window.location.origin}});if(s)throw new Error(`OAuth sign in failed: ${s.message}`)}onAuthStateChange(e){const{data:{subscription:s}}=this.ensureSupabase().auth.onAuthStateChange((s,r)=>{e(r?.user||null,r)});return()=>{s.unsubscribe()}}async isAuthenticated(){return null!==await this.getSession()}async getAccessToken(){const e=await this.getSession();return e?.access_token||null}getSupabase(){return this.supabase}},a={user:null,session:null,isAuthenticated:!1,isLoading:!0,error:null},i=function(){const{subscribe:e,set:t,update:i}=s(a);let o=null;return{subscribe:e,initialize:async function(){if("undefined"!=typeof window&&(window.navigator.userAgent.includes("Playwright")||window.location.search.includes("test=true")))return r.info("[authStore] Test mode detected - bypassing authentication"),void i(e=>({...e,user:{id:"test-user-id",email:"test@playwright.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:(new Date).toISOString()},session:{access_token:"test-token",token_type:"bearer",user:{id:"test-user-id",email:"test@playwright.com"}},isAuthenticated:!0,isLoading:!1,error:null}));try{const e=await n.getSession(),s=await n.getCurrentUser();i(r=>({...r,user:s,session:e,isAuthenticated:!!s,isLoading:!1})),o=n.onAuthStateChange((e,s)=>{i(r=>({...r,user:e,session:s,isAuthenticated:!!e,error:null}))})}catch(e){r.error("Auth initialization error:",e),i(s=>({...s,isLoading:!1,error:e instanceof Error?e.message:"Auth initialization failed"}))}},signIn:async function(e,s){i(e=>({...e,isLoading:!0,error:null}));try{const r=await n.signIn(e,s),t=await n.getCurrentUser();return i(e=>({...e,user:t,session:r,isAuthenticated:!0,isLoading:!1})),{success:!0}}catch(e){const s=e instanceof Error?e.message:"Sign in failed";return i(e=>({...e,isLoading:!1,error:s})),{success:!1,error:s}}},signUp:async function(e,s,r){i(e=>({...e,isLoading:!0,error:null}));try{return await n.signUp(e,s,r),i(e=>({...e,isLoading:!1})),{success:!0}}catch(e){const s=e instanceof Error?e.message:"Sign up failed";return i(e=>({...e,isLoading:!1,error:s})),{success:!1,error:s}}},signOut:async function(){i(e=>({...e,isLoading:!0,error:null}));try{return await n.signOut(),i(e=>({...a,isLoading:!1})),{success:!0}}catch(e){const s=e instanceof Error?e.message:"Sign out failed";return i(e=>({...e,isLoading:!1,error:s})),{success:!1,error:s}}},clearError:function(){i(e=>({...e,error:null}))},cleanup:function(){o&&(o(),o=null)}}}();e(i,e=>e.user),e(i,e=>e.isAuthenticated),e(i,e=>e.isLoading);export{t as s};
